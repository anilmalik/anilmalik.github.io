<html>
  <head>
    <title>ICMR cat 17 entry</title>
    <script>
      const Cookie = {
          get: name => {
              let c = document.cookie.match(`(?:(?:^|.*; *)${name} *= *([^;]*).*$)|^.*$`)[1]
              if (c) return decodeURIComponent(c)
          },
          set: (name, value, opts = {}) => {
              /*If options contains days then we're configuring max-age*/
              if (opts.days) {
                  opts['max-age'] = opts.days * 60 * 60 * 24;

                  /*Deleting days from options to pass remaining opts to cookie settings*/
                  delete opts.days 
              }

              /*Configuring options to cookie standard by reducing each property*/
              opts = Object.entries(opts).reduce(
                  (accumulatedStr, [k, v]) => `${accumulatedStr}; ${k}=${v}`, ''
              )

              /*Finally, creating the key*/
              document.cookie = name + '=' + encodeURIComponent(value) + opts
          }
          //delete: (name, opts) => Cookie.set(name, '', {'max-age': -1, ...opts}) 
          // path & domain must match cookie being deleted 
      }
      function checkCookies() {
        if (Cookie.get("PHPSESSID") === undefined) {
          var s = prompt("Cookies not found. \nPlease enter value of PHPSESSID", "");
          var d = prompt("Please enter value of SERVERID_7_81", "");
          Cookie.set("PHPSESSID", s);
          Cookie.set("SERVERID_7_81", d);
          alert("Cookies set successfully");
        }
      }
      function getNextDate(e) {
        return (e.getDate().toString().replace(/^(\d)$/, "0$1") + "-" +
          (1 + e.getMonth()).toString().replace(/^(\d)$/, "0$1") + "-" +
          e.getFullYear() + " " + 
          e.getHours().toString().replace(/^(\d)$/, "0$1") + ":" +
          e.getMinutes().toString().replace(/^(\d)$/, "0$1") + ":00"
        );
      }
      function onClick(isPositive) {
        // alert(isPositive ? "Antigen Positive" : "Antigen Negative");
        var e = localStorage.getItem("auto_id") || "10",
            o = prompt("Patient ID:", "MPS" + e);
        (suggestDT = new Date(parseInt(localStorage.getItem("auto_datetime"), 10) || Date.now())), suggestDT.setMinutes(suggestDT.getMinutes() + 5);
        var a = getNextDate(suggestDT),
            t = prompt("DateTime:", a),
            d = new Date(...t.split(/[-:\s]/i).map((e, o, a) => parseInt(0 === o ? a[2] : 1 === o ? a[o] - 1 : 2 === o ? a[0] : a[o], 10)));
        d.setMinutes(d.getMinutes() + 5);
        var p = getNextDate(d);
        d.setMinutes(d.getMinutes() + 5);
        var n = getNextDate(d);
        (name = prompt("Patient Name:")),
            (age = prompt("Patient Age:")),
            (gender = prompt("Patient Gender:", "M")),
            (address = prompt("Patient Address:", "")),
            (phone = prompt("Patient Phone:")),
            (bodyForm = new FormData()),
            bodyForm.append("patient_id", o),
            bodyForm.append("sample_id", o),
            bodyForm.append("patient_name", name),
            bodyForm.append("address", address),
            bodyForm.append("contact_number", phone),
            bodyForm.append("age", age),
            bodyForm.append("gender", gender),
            bodyForm.append("sample_cdate", t),
            bodyForm.append("sample_tdate", n),
            bodyForm.append("sample_rdate", p),
            bodyForm.append("email", ""),
            bodyForm.append("aadhar_number", ""),
            bodyForm.append("passport_number", ""),
            bodyForm.append("village_town", ""),
            bodyForm.append("patient_category", "NCat17"),
            bodyForm.append("age_in", "Years"),
            bodyForm.append("contact_number_belongs_to", "patient"),
            bodyForm.append("nationality", "India"),
            bodyForm.append("state", "7"),
            bodyForm.append("district", "84"),
            bodyForm.append("pincode", ""),
            bodyForm.append("aarogya_setu_app_downloaded", "Yes"),
            bodyForm.append("date_of_arrival_in_india", ""),
            bodyForm.append("quarantined", "No"),
            bodyForm.append("otp_verified_srf", ""),
            bodyForm.append("final_status", ""),
            bodyForm.append("sample_type", "Nasopharyngeal swab"),
            bodyForm.append("status", ""),
            bodyForm.append("other_underlying_medical_conditions", ""),
            bodyForm.append("final_result_of_sample", "Antigen Negative"),
            bodyForm.append("hospitalized", "No"),
            bodyForm.append("testing_kit_used", "Ag-SD_Biosensor_Standard_Q_COVID-19_Ag_detection_kit"),
            bodyForm.append("repeat_sample", "No"),
            bodyForm.append("srf_id", ""),
            bodyForm.append("page", "add_record_antigen"),
            bodyForm.append("date_of_onset_of_symptoms", ""),
            [o, t, name, address, phone, age, gender].includes(null) ||
                fetch("https://cvstatus.icmr.gov.in/submit.php", { method: "POST", mode: "cors", credentials: "include", body: bodyForm })
                    .then((e) => e.text())
                    .then((o) => {
                        localStorage.setItem("auto_id", parseInt(e) + 1),
                            localStorage.setItem("auto_datetime", new Date(...t.split(/[-:\s]/i).map((e, o, a) => parseInt(0 === o ? a[2] : 1 === o ? a[o] - 1 : 2 === o ? a[0] : a[o], 10))).getTime()),
                            alert(o);
                    });
      }
    </script>
  </head>
  <body style="text-align:center" onload="checkCookies()">
    <h3>icmr cat 8 entry<h3><br/>
    <a href='javascript:onClick(false);'>ICMR NCat8 -ve</a><br/><br/>
      <!--<a href='javascript:onClick(true);'>ICMR NCat8 +ve</a>-->
  </body>
</html>
